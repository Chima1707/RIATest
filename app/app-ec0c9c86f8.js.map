{"version":3,"sources":["app/app.module.js","app/layouts/navbar/navbar.controller.js","app/flight-delays/flight-delays.state.js","app/flight-delays/flight-delays.service.js","app/flight-delays/flight-delays.controller.js","app/flight-delays/flight-delays.charts.service.js","app/flight-delays/analysis/analysis.controller.js","app/app.state.js","app/app.constants.js","app/app.js"],"names":["config","$urlRouterProvider","cfpLoadingBarProvider","latencyThreshold","includeSpinner","otherwise","angular","module","constant","id","name","$inject","NavbarController","toggleNavbar","vm","isNavbarCollapsed","collapseNavbar","this","controller","stateConfig","$stateProvider","state","parent","url","views","content@","templateUrl","controllerAs","FlightDelayService","$http","DATA_URL","DATA_INFO","$q","$localForage","getDataAsArray","row","res","data","split","slice","filter","line","convertDataToJson","seperator","getTimeAsMinuteOfDay","str","arr","match","map","Number","hour","min","filterString","replace","getDelayRatio","arrivalDelay","elapsedTime","cols","flightDate","Date","FLIGHT_DATE_COL","day","getDay","distance","DISTANCE_COL","departureTime","DEP_TIME_COL","departureTimeMin","arrivalTime","ARR_TIME_COL","arrivalTimeMin","ELAPSED_TIME_COL","ARR_DELAY_COL","delayed","delayRatio","origin","String","ORIGIN_COL","destination","DEST_COL","addAirPortData","forEach","item","airports","Object","keys","getFlightDelayDataLocal","flightDelayData","when","getItem","then","reject","Error","getFlightDelayDataRemote","get","bind","START_INDEX","SEPERATOR","cacheData","setItem","queryFlightDelays","query","delayTimeData","delayRatioData","totalDelayRatio","maxDelayRatio","push","averageDelayRatio","length","Math","round","getFlightDelayData","getDelaysByDistance","delays","distances","validateQuery","every","key","factory","FlightDelaysController","$timeout","WEEK_DAYS","FlightDelayChartService","cfpLoadingBar","preBind","interval","d","getArrivalDelayHistogramData","options","range","bins","intervals","binData","d3","layout","histogram","chartData","bar","values","localMaxY","y","x","max","selected","weekDays","chartOptions","arrivalDelayTime","xAxis","yAxis","arrivalDelayRatio","xAxisFormat","drawLine","value","text","chartId","histogramOptions","enableSearch","search","start","complete","delayData","arrivalData","arrivalDelaytime","getHistogramOptions","delayRatioChartInterval","getYDomain","yDomain","chart","type","margin","top","right","bottom","left","useInteractiveGuideline","callback","xScale","scale","svg","select","height","onXAxis","append","style","attr","i","showValues","valueFormat","format","duration","axisLabel","tickFormat","isFunction","ticks","axisLabelDistance","getScatterChartOptions","scatterChartOptions","showDistX","showDistY","tooltipContent","FlightDelaysAnalysisController","getAnalysisData","index","strokeWidth","classed","analysis","abstract","navbar@","resolve","run","$templateCache","put"],"mappings":"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","file":"app/app-ec0c9c86f8.js","sourcesContent":["(function () {\n  'use strict'\n\n  angular\n        .module('App', [\n          'ui.bootstrap',\n          'ui.router',\n          'LocalForageModule',\n          'ui.select',\n          'ngSanitize',\n          'nvd3',\n          'angular-loading-bar',\n          'ngAnimate'\n        ])\n        .config(config)\n        .constant('WEEK_DAYS', [\n            { id: 0, name: 'Sunday' },\n            { id: 1, name: 'Monday' },\n            { id: 2, name: 'Tuesday' },\n            { id: 3, name: 'Wednesday' },\n            { id: 4, name: 'Thursday' },\n            { id: 5, name: 'Friday' },\n            { id: 6, name: 'Saturday' }\n        ])\n\n  config.$inject = ['$urlRouterProvider', 'cfpLoadingBarProvider']\n  function config ($urlRouterProvider, cfpLoadingBarProvider) {\n    cfpLoadingBarProvider.latencyThreshold = 100\n    cfpLoadingBarProvider.includeSpinner = false\n    $urlRouterProvider.otherwise('/flight-delays')\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .controller('NavbarController', NavbarController)\n\n  NavbarController.$inject = []\n\n  function NavbarController () {\n    var vm = this\n\n    vm.isNavbarCollapsed = true\n\n    vm.toggleNavbar = toggleNavbar\n    vm.collapseNavbar = collapseNavbar\n\n    function toggleNavbar () {\n      vm.isNavbarCollapsed = !vm.isNavbarCollapsed\n    }\n\n    function collapseNavbar () {\n      vm.isNavbarCollapsed = true\n    }\n  }\n})()\n","(function () {\n  'use strict'\n  angular\n        .module('App')\n        .config(stateConfig)\n\n  stateConfig.$inject = ['$stateProvider']\n\n  function stateConfig ($stateProvider) {\n    $stateProvider.state('flight-delays', {\n      parent: 'app',\n      url: '/flight-delays',\n      views: {\n        'content@': {\n          templateUrl: 'app/flight-delays/flight-delays.html',\n          controller: 'FlightDelaysController',\n          controllerAs: 'vm'\n        }\n      }\n    })\n    $stateProvider.state('analysis', {\n      parent: 'app',\n      url: '/analysis',\n      views: {\n        'content@': {\n          templateUrl: 'app/flight-delays/analysis/analysis.html',\n          controller: 'FlightDelaysAnalysisController',\n          controllerAs: 'vm'\n        }\n      }\n    })\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .factory('FlightDelayService', FlightDelayService)\n\n  FlightDelayService.$inject = ['$http', 'DATA_URL', 'DATA_INFO', '$q', '$localForage']\n\n  function FlightDelayService ($http, DATA_URL, DATA_INFO, $q, $localForage) {\n    var flightDelayData\n\n        /**\n         * Split csv file contents into array of strings starting from a specifed index.\n         * @param {Number} row - row to start slice from.\n         * @param {String} res - Multiine string representing csv file contents.\n         * @returns {Array} = Array of strings, each line representing an row in the file.\n         */\n    function getDataAsArray (row, res) {\n      var data = res.data\n      return data.split('\\n').slice(row).filter(function (line) {\n        return line\n      })\n    }\n\n        /**\n         * Converts an array of strings into array of objects.\n         * @param {Array} data- Array of strings.\n         * @param {String} separator - split strings by.\n         * @returns {Array} = Array of objects.\n         */\n    function convertDataToJson (seperator, data) {\n      seperator = seperator || ','\n\n      function getTimeAsMinuteOfDay (str) {\n                // get minutes of the day, 12:00 => 720 minute of the day\n        var arr = str.match(/.{1,2}/g).map(Number)\n        var hour = arr[0]\n        var min = arr[1]\n        return !hour ? min : (hour * 60) + min\n      }\n\n      function filterString (str) {\n        return str.replace(/\"/g, '')\n      }\n\n      function getDelayRatio (arrivalDelay, elapsedTime) {\n                // delay ratio is arrival delay in minutes / flight elapsed time in minutes\n        return (arrivalDelay / elapsedTime) * 100\n      }\n            // map through all the array entries, converting each entry to a corresponding object.\n      return data.map(function (line) {\n        var cols = line.split(seperator)\n        var flightDate = new Date(cols[DATA_INFO.FLIGHT_DATE_COL])\n        var day = flightDate.getDay()\n\n        var distance = Number(cols[DATA_INFO.DISTANCE_COL])\n        var departureTime = cols[DATA_INFO.DEP_TIME_COL]\n\n        departureTime = filterString(departureTime)\n        var departureTimeMin = getTimeAsMinuteOfDay(departureTime)\n\n        var arrivalTime = cols[DATA_INFO.ARR_TIME_COL]\n        arrivalTime = filterString(arrivalTime)\n        var arrivalTimeMin = getTimeAsMinuteOfDay(arrivalTime)\n\n        var elapsedTime = Number(cols[DATA_INFO.ELAPSED_TIME_COL])\n\n        var arrivalDelay = Number(cols[DATA_INFO.ARR_DELAY_COL])\n        var delayed = arrivalDelay > 0   // if its an arrival delay the precalculate its delayRatio\n        var delayRatio = delayed ? getDelayRatio(arrivalDelay, elapsedTime) : 0\n\n        var origin = String(cols[DATA_INFO.ORIGIN_COL])\n        origin = filterString(origin)\n\n        var destination = String(cols[DATA_INFO.DEST_COL])\n        destination = filterString(destination)\n\n        return {\n          flightDate: flightDate,\n          day: day,\n          origin: origin,\n          destination: destination,\n          departureTime: departureTime,\n          departureTimeMin: departureTimeMin,\n          arrivalTime: arrivalTime,\n          arrivalTimeMin: arrivalTimeMin,\n          arrivalDelay: arrivalDelay,\n          elapsedTime: elapsedTime,\n          distance: distance,\n          delayed: delayed,\n          delayRatio: delayRatio\n        }\n      })\n    }\n\n        /**\n         * Enrich data with airport name list.\n         * @param {Array} data- Array of flight schedule objects.\n         * @returns {Object} = Object composed of array flight schedule and airport name list.\n         */\n    function addAirPortData (data) {\n      var res = {}\n      data.forEach(function (item) {\n        if (!res[item.origin]) {\n          res[item.origin] = true\n        }\n        if (!res[item.destination]) {\n          res[item.destination] = true\n        }\n      })\n      var airports = Object.keys(res)\n      return { data: data, airports: airports }\n    }\n\n        /**\n         * Called to get flight delay data from memory or from local database.\n         * @returns {Promise} = Promise will resolve to flight delay data or reject when not found locally.\n         */\n    function getFlightDelayDataLocal () {\n      if (flightDelayData) { // if data exists as private variable resolve with it\n        return $q.when(flightDelayData)\n      } else {\n        return $localForage.getItem('flightData').then(function (data) {\n          if (!data) {  // if not found in local forage, reject with an error\n            return $q.reject(new Error('data not found'))\n          }\n          flightDelayData = data  // Set data in private variable and resolve with it\n          return $q.when(flightDelayData)\n        })\n      }\n    }\n\n        /**\n         * Called to get data from remote when data does not exists locally.\n         * @returns {Promise} = Promise will resolve with data or reject with error.\n         */\n    function getFlightDelayDataRemote () {\n      return $http.get(DATA_URL)\n                .then(getDataAsArray.bind(null, DATA_INFO.START_INDEX))\n                .then(convertDataToJson.bind(null, DATA_INFO.SEPERATOR))\n                .then(addAirPortData)\n                .then(cacheData)\n                .catch($q.reject)\n    }\n\n        /**\n         * Caches data locally in local database and in a private variable.\n         * @returns {Promise} = Promise will resolves with data, or rejects with error.\n         */\n    function cacheData (data) {\n      return $localForage.setItem('flightData', data)\n                .then(function (res) {\n                  flightDelayData = res // store in instance variable\n                  return flightDelayData\n                })\n    }\n\n        /**\n         * Queries for flight delays.\n         * @param {Object} query - Represents selected data points, day, origin and destination.\n         * @param {String} data - Flight delays data.\n         * @returns {Object} = Object representing delay  data, delay ratio data, average delay ratio, max delay ratio.\n         */\n    function queryFlightDelays (query, data) {\n      var delayTimeData = []\n      var delayRatioData = []\n      var totalDelayRatio = 0\n      var maxDelayRatio = 0\n      data.filter(function (item) { // if delayed and it matches query parameters\n        return item.delayed &&\n                    item.day === query.day.id &&\n                    item.destination === query.destination &&\n                    item.origin === query.origin\n      })\n                .forEach(function (item) {\n                  delayTimeData.push(item.departureTimeMin) // add time the flight departed to its list\n                  delayRatioData.push(item.delayRatio) // add delay ratio(precalculated) to its list\n                  totalDelayRatio += item.delayRatio   // add to total delay ratio used for calculating average delay ratio\n                  if (item.delayRatio > maxDelayRatio) { // keep track of the max delay ratio, used for ploting histogram\n                    maxDelayRatio = item.delayRatio\n                  }\n                })\n            // get average delay ratio\n      var averageDelayRatio = !delayRatioData.length ? 0 : Math.round((totalDelayRatio / delayRatioData.length) * 100) / 100\n      maxDelayRatio = Math.round(maxDelayRatio)\n      return { delayTimeData: delayTimeData, delayRatioData: delayRatioData, averageDelayRatio: averageDelayRatio, maxDelayRatio: maxDelayRatio }\n    }\n\n        /**\n         * Called to get data, check data locally first, if not found check remotely.\n         * @returns {Promise} = Promise resolves with data or reject.\n         */\n    function getFlightDelayData () {\n      return getFlightDelayDataLocal()\n                .catch(getFlightDelayDataRemote)\n    }\n\n        /**\n         * Queries for flight delays.\n         * @param {Object} query - Represents selected data points, day, origin.\n         * @param {String} data - Flight delays data.\n         * @returns {Object} = Object representing list of delays and corresponding list of distance.\n         */\n    function getDelaysByDistance (query, data) {\n      var delays = []\n      var distances = []\n      data.filter(function (item) {\n        return item.delayed && item.day === query.day.id && item.origin === query.origin\n      }).forEach(function (item) {\n        delays.push(item.arrivalDelay)\n        distances.push(item.distance)\n      })\n      return { delays: delays, distances: distances }\n    }\n\n    function validateQuery (query) {\n      return Object.keys(query).every(function (key) {\n        return query[key]\n      })\n    }\n\n    return {\n      getFlightDelayData: getFlightDelayData,\n      queryFlightDelays: queryFlightDelays,\n      getDelaysByDistance: getDelaysByDistance,\n      validateQuery: validateQuery\n    }\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .controller('FlightDelaysController', FlightDelaysController)\n\n  FlightDelaysController.$inject = ['$timeout', 'WEEK_DAYS', 'FlightDelayService', 'FlightDelayChartService', 'flightDelayData', 'cfpLoadingBar']\n\n  function FlightDelaysController ($timeout, WEEK_DAYS, FlightDelayService, FlightDelayChartService, flightDelayData, cfpLoadingBar) {\n    var vm = this\n    vm.flightDelayData = flightDelayData\n    vm.selected = { day: '', origin: '', destination: '' } // keep track of search parameters\n\n    vm.weekDays = WEEK_DAYS\n\n    var chartOptions = {\n      arrivalDelayTime: { // keep track of arrival delays chart options\n        bins: 24,\n        max: 0,\n        intervals: 60,\n        xAxis: 'Hour of the day (departure time)',\n        yAxis: 'Frequency of arrival delays'\n      },\n      arrivalDelayRatio: { // keep track of arrival delay ratio chart options.\n        xAxisFormat: null,\n        bins: 10,\n        max: 0,\n        intervals: 10,\n        xAxis: 'Delay ratio in %',\n        yAxis: 'Frequency of arrival delay  ratio',\n        drawLine: { value: 0, text: 'Average(%) is ', chartId: 'ratios' }\n      }\n    }\n\n    function preBind (interval) { // prebind interval to x axis chart tick\n      return function (d) {\n        return Math.round(d * interval)\n      }\n    }\n\n    vm.chartData = {} //\n    vm.histogramOptions = {}\n\n    vm.enableSearch = function () {\n      return FlightDelayService.validateQuery(vm.selected)\n    }\n\n    vm.search = function () {\n      cfpLoadingBar.start()\n\n      $timeout(function () {\n        cfpLoadingBar.complete()\n        // get data that matches the current selection\n        var delayData = FlightDelayService.queryFlightDelays(vm.selected, vm.flightDelayData.data)\n            // set delay chart properties\n        var arrivalData = getArrivalDelayHistogramData(delayData.delayTimeData, chartOptions.arrivalDelayTime)\n        vm.chartData.arrivalDelaytime = arrivalData.chartData\n        chartOptions.arrivalDelayTime.max = arrivalData.max // set chart max y axis option\n\n        vm.histogramOptions.arrivalDelayTime = FlightDelayChartService.getHistogramOptions(chartOptions.arrivalDelayTime)\n\n        var averageDelayRatio = delayData.averageDelayRatio\n        var maxDelayRatio = delayData.maxDelayRatio\n        chartOptions.arrivalDelayRatio.drawLine.value = averageDelayRatio // set the value of the average delay ratio\n            // set interval here based on maxDelayRatio\n            // maxDelayRatio/bins\n        var delayRatioChartInterval = maxDelayRatio ? maxDelayRatio / chartOptions.arrivalDelayRatio.bins : 10\n        chartOptions.arrivalDelayRatio.intervals = delayRatioChartInterval\n            // prebind intervals into xAxis formatter\n        chartOptions.arrivalDelayRatio.xAxisFormat = preBind(chartOptions.arrivalDelayRatio.intervals)\n\n            // set delay ratio chart properties\n        var delayRatioData = getArrivalDelayHistogramData(delayData.delayRatioData, chartOptions.arrivalDelayRatio)\n        vm.chartData.arrivalDelayRatio = delayRatioData.chartData\n        chartOptions.arrivalDelayRatio.max = delayRatioData.max\n        vm.histogramOptions.arrivalDelayRatio = FlightDelayChartService.getHistogramOptions(chartOptions.arrivalDelayRatio)\n      }, 2000)\n    }\n\n        /**\n         * Get the required histogram data. called by both histogram charts\n         * @param {Object} data- Chart data.\n         * @param {Object}  options-  options.\n         * @returns {Object} = Object with  Chart Data and max y axis value.\n         */\n    function getArrivalDelayHistogramData (data, options) {\n      var range = [0, options.bins * options.intervals] // range on the xaxis\n      var binData = d3.layout.histogram().bins(options.bins).range(range)(data)\n      var chartData = { bar: true, values: [] }\n      var localMaxY = 0\n      binData.forEach(function (item) {\n        if (localMaxY < item.y) {\n          localMaxY = item.y\n        }\n        chartData.values.push([item.x, item.y])\n      })\n      return { chartData: [chartData], max: localMaxY }\n    }\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .factory('FlightDelayChartService', FlightDelayChartService)\n\n  FlightDelayChartService.$inject = []\n\n  function FlightDelayChartService () {\n        /**\n         * Get the options required for a histogram.\n         * @param {Object} options- option.\n         * @returns {Object} = Chart option.\n         */\n    function getHistogramOptions (options) {\n      function getYDomain () {\n        return options.max ? [0, options.max] : [0]\n      }\n\n      var yDomain = getYDomain()\n      var histogramOptions = {\n        chart: {\n          type: 'historicalBarChart',\n          margin: {\n            top: 20,\n            right: 20,\n            bottom: 65,\n            left: 50\n          },\n          useInteractiveGuideline: false,\n          callback: function (chart) {\n            if (options.drawLine && options.drawLine.value) {\n              var xScale = chart.xAxis.scale()\n              var margin = chart.margin()\n              var svg = d3.select('#' + options.drawLine.chartId + ' svg')\n              var height = chart.height()\n              var onXAxis = xScale(options.drawLine.value) / options.intervals\n              svg.append('line')\n                                .style('stroke', '#FF7F0E')\n                                .style('stroke-width', '2.5px')\n                                .attr('x1', onXAxis + margin.left)\n                                .attr('y1', margin.top)\n                                .attr('x2', onXAxis + margin.left)\n                                .attr('y2', height - margin.bottom)\n              svg.append('text')\n                                .attr('x', onXAxis + margin.left)\n                                .attr('y', margin.top)\n                                .text(options.drawLine.text + '' + options.drawLine.value)\n            }\n          },\n          height: 300,\n          x: function (d, i) {\n            return i\n          },\n          y: function (d) {\n            return d[1]\n          },\n          showValues: true,\n          valueFormat: function (d) {\n            return d3.format(',.1f')(d)\n          },\n          duration: 100,\n          xAxis: {\n            axisLabel: options.xAxis,\n            tickFormat: function (d) {\n              var format = options.xAxisFormat\n              return format && angular.isFunction(format) ? format(d) : d\n            },\n            ticks: options.bins\n\n          },\n          yAxis: {\n            axisLabel: options.yAxis,\n            axisLabelDistance: -10,\n            tickFormat: function (d) {\n              return d3.format(',.1f')(d)\n            }\n          },\n          yDomain: yDomain\n        }\n      }\n      return histogramOptions\n    }\n\n    function getScatterChartOptions (options) {\n      var scatterChartOptions = {\n        chart: {\n          type: 'scatterChart',\n          height: 400,\n\n          showDistX: true,\n          showDistY: true,\n          tooltipContent: function (key) {\n            return '<h3>' + key + '</h3>'\n          },\n          duration: 100,\n          useInteractiveGuideline: true,\n          xAxis: {\n            axisLabel: options.xAxis\n          },\n          yAxis: {\n            axisLabel: options.yAxis,\n            tickFormat: function (d) {\n              return d3.format('.02f')(d)\n            },\n            axisLabelDistance: -5\n          }\n        }\n      }\n      return scatterChartOptions\n    }\n    return {\n      getHistogramOptions: getHistogramOptions,\n      getScatterChartOptions: getScatterChartOptions\n    }\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n    .module('App')\n    .controller('FlightDelaysAnalysisController', FlightDelaysAnalysisController)\n\n  FlightDelaysAnalysisController.$inject = ['$timeout', 'WEEK_DAYS', 'FlightDelayService', 'FlightDelayChartService', 'flightDelayData', 'cfpLoadingBar']\n\n  function FlightDelaysAnalysisController ($timeout, WEEK_DAYS, FlightDelayService, FlightDelayChartService, flightDelayData, cfpLoadingBar) {\n    var vm = this\n    vm.chartOptions = { xAxis: 'Distance in miles', yAxis: 'Arrival delay in minutes' }\n    vm.analysis = {}\n    vm.weekDays = WEEK_DAYS\n    vm.flightDelayData = flightDelayData\n\n    vm.selected = { day: '', origin: '' }\n\n    vm.enableSearch = function () {\n      return FlightDelayService.validateQuery(vm.selected)\n    }\n\n    vm.search = function () {\n      cfpLoadingBar.start()\n      $timeout(function () {\n        cfpLoadingBar.complete()\n        // get delays and corresponding distances for selected params\n        var data = FlightDelayService.getDelaysByDistance(vm.selected, vm.flightDelayData.data)\n        var chartData = getAnalysisData(data) // format as chart data\n        vm.analysis.data = chartData\n        vm.analysis.options = FlightDelayChartService.getScatterChartOptions(vm.chartOptions) // get chart params\n      }, 1000)\n    }\n       /**\n         * Get the required histogram data. called by both histogram charts\n         * @param {Object} data- Object representing delays and distances.\n         * @param {Object}  options-  options.\n         * @returns {Object} = Object with  Chart Data.\n         */\n    function getAnalysisData (data) {\n      var distances = data.distances\n      var delays = data.delays\n      var values = distances.map(function (distance, index) {\n        return { x: distance, y: delays[index] }\n      })\n\n      return [{\n        values: values,\n        key: 'Arrival delay against distance',\n        strokeWidth: 2,\n        classed: 'dashed'\n      }]\n    }\n  }\n})()\n","(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .config(stateConfig)\n\n  stateConfig.$inject = ['$stateProvider']\n\n  function stateConfig ($stateProvider) {\n    $stateProvider.state('app', {\n      abstract: true,\n      views: {\n        'navbar@': {\n          templateUrl: 'app/layouts/navbar/navbar.html',\n          controller: 'NavbarController',\n          controllerAs: 'vm'\n        }\n      },\n      resolve: {\n        flightDelayData: ['FlightDelayService',\n          function (FlightDelayService) {\n            return FlightDelayService.getFlightDelayData()\n          }\n        ]\n      }\n    })\n  }\n})()\n","(function () {\n  'use strict'\n    // DO NOT EDIT THIS FILE, EDIT THE GULP TASK NGCONSTANT SETTINGS INSTEAD WHICH GENERATES THIS FILE\n    angular\n        .module('App')\n        .constant('DEBUG_INFO_ENABLED', false)\n        .constant('DATA_URL', \"/RIATest/content/data.csv\")\n        .constant('DATA_INFO', {\n\t\"START_INDEX\": 1,\n\t\"SEPERATOR\": \",\",\n\t\"FLIGHT_DATE_COL\": 0,\n\t\"ORIGIN_COL\": 1,\n\t\"DEST_COL\": 2,\n\t\"DEP_TIME_COL\": 3,\n\t\"ARR_TIME_COL\": 4,\n\t\"ARR_DELAY_COL\": 5,\n\t\"ELAPSED_TIME_COL\": 6,\n\t\"DISTANCE_COL\": 7\n})\n;\n})();\n","(function () {\n  'use strict'\n\n  angular\n        .module('App', [\n          'ui.bootstrap',\n          'ui.router',\n          'LocalForageModule',\n          'ui.select',\n          'ngSanitize',\n          'nvd3',\n          'angular-loading-bar',\n          'ngAnimate'\n        ])\n        .config(config)\n        .constant('WEEK_DAYS', [\n            { id: 0, name: 'Sunday' },\n            { id: 1, name: 'Monday' },\n            { id: 2, name: 'Tuesday' },\n            { id: 3, name: 'Wednesday' },\n            { id: 4, name: 'Thursday' },\n            { id: 5, name: 'Friday' },\n            { id: 6, name: 'Saturday' }\n        ])\n\n  config.$inject = ['$urlRouterProvider', 'cfpLoadingBarProvider']\n  function config ($urlRouterProvider, cfpLoadingBarProvider) {\n    cfpLoadingBarProvider.latencyThreshold = 100\n    cfpLoadingBarProvider.includeSpinner = false\n    $urlRouterProvider.otherwise('/flight-delays')\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .controller('NavbarController', NavbarController)\n\n  NavbarController.$inject = []\n\n  function NavbarController () {\n    var vm = this\n\n    vm.isNavbarCollapsed = true\n\n    vm.toggleNavbar = toggleNavbar\n    vm.collapseNavbar = collapseNavbar\n\n    function toggleNavbar () {\n      vm.isNavbarCollapsed = !vm.isNavbarCollapsed\n    }\n\n    function collapseNavbar () {\n      vm.isNavbarCollapsed = true\n    }\n  }\n})()\n;\n(function () {\n  'use strict'\n  angular\n        .module('App')\n        .config(stateConfig)\n\n  stateConfig.$inject = ['$stateProvider']\n\n  function stateConfig ($stateProvider) {\n    $stateProvider.state('flight-delays', {\n      parent: 'app',\n      url: '/flight-delays',\n      views: {\n        'content@': {\n          templateUrl: 'app/flight-delays/flight-delays.html',\n          controller: 'FlightDelaysController',\n          controllerAs: 'vm'\n        }\n      }\n    })\n    $stateProvider.state('analysis', {\n      parent: 'app',\n      url: '/analysis',\n      views: {\n        'content@': {\n          templateUrl: 'app/flight-delays/analysis/analysis.html',\n          controller: 'FlightDelaysAnalysisController',\n          controllerAs: 'vm'\n        }\n      }\n    })\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .factory('FlightDelayService', FlightDelayService)\n\n  FlightDelayService.$inject = ['$http', 'DATA_URL', 'DATA_INFO', '$q', '$localForage']\n\n  function FlightDelayService ($http, DATA_URL, DATA_INFO, $q, $localForage) {\n    var flightDelayData\n\n        /**\n         * Split csv file contents into array of strings starting from a specifed index.\n         * @param {Number} row - row to start slice from.\n         * @param {String} res - Multiine string representing csv file contents.\n         * @returns {Array} = Array of strings, each line representing an row in the file.\n         */\n    function getDataAsArray (row, res) {\n      var data = res.data\n      return data.split('\\n').slice(row).filter(function (line) {\n        return line\n      })\n    }\n\n        /**\n         * Converts an array of strings into array of objects.\n         * @param {Array} data- Array of strings.\n         * @param {String} separator - split strings by.\n         * @returns {Array} = Array of objects.\n         */\n    function convertDataToJson (seperator, data) {\n      seperator = seperator || ','\n\n      function getTimeAsMinuteOfDay (str) {\n                // get minutes of the day, 12:00 => 720 minute of the day\n        var arr = str.match(/.{1,2}/g).map(Number)\n        var hour = arr[0]\n        var min = arr[1]\n        return !hour ? min : (hour * 60) + min\n      }\n\n      function filterString (str) {\n        return str.replace(/\"/g, '')\n      }\n\n      function getDelayRatio (arrivalDelay, elapsedTime) {\n                // delay ratio is arrival delay in minutes / flight elapsed time in minutes\n        return (arrivalDelay / elapsedTime) * 100\n      }\n            // map through all the array entries, converting each entry to a corresponding object.\n      return data.map(function (line) {\n        var cols = line.split(seperator)\n        var flightDate = new Date(cols[DATA_INFO.FLIGHT_DATE_COL])\n        var day = flightDate.getDay()\n\n        var distance = Number(cols[DATA_INFO.DISTANCE_COL])\n        var departureTime = cols[DATA_INFO.DEP_TIME_COL]\n\n        departureTime = filterString(departureTime)\n        var departureTimeMin = getTimeAsMinuteOfDay(departureTime)\n\n        var arrivalTime = cols[DATA_INFO.ARR_TIME_COL]\n        arrivalTime = filterString(arrivalTime)\n        var arrivalTimeMin = getTimeAsMinuteOfDay(arrivalTime)\n\n        var elapsedTime = Number(cols[DATA_INFO.ELAPSED_TIME_COL])\n\n        var arrivalDelay = Number(cols[DATA_INFO.ARR_DELAY_COL])\n        var delayed = arrivalDelay > 0   // if its an arrival delay the precalculate its delayRatio\n        var delayRatio = delayed ? getDelayRatio(arrivalDelay, elapsedTime) : 0\n\n        var origin = String(cols[DATA_INFO.ORIGIN_COL])\n        origin = filterString(origin)\n\n        var destination = String(cols[DATA_INFO.DEST_COL])\n        destination = filterString(destination)\n\n        return {\n          flightDate: flightDate,\n          day: day,\n          origin: origin,\n          destination: destination,\n          departureTime: departureTime,\n          departureTimeMin: departureTimeMin,\n          arrivalTime: arrivalTime,\n          arrivalTimeMin: arrivalTimeMin,\n          arrivalDelay: arrivalDelay,\n          elapsedTime: elapsedTime,\n          distance: distance,\n          delayed: delayed,\n          delayRatio: delayRatio\n        }\n      })\n    }\n\n        /**\n         * Enrich data with airport name list.\n         * @param {Array} data- Array of flight schedule objects.\n         * @returns {Object} = Object composed of array flight schedule and airport name list.\n         */\n    function addAirPortData (data) {\n      var res = {}\n      data.forEach(function (item) {\n        if (!res[item.origin]) {\n          res[item.origin] = true\n        }\n        if (!res[item.destination]) {\n          res[item.destination] = true\n        }\n      })\n      var airports = Object.keys(res)\n      return { data: data, airports: airports }\n    }\n\n        /**\n         * Called to get flight delay data from memory or from local database.\n         * @returns {Promise} = Promise will resolve to flight delay data or reject when not found locally.\n         */\n    function getFlightDelayDataLocal () {\n      if (flightDelayData) { // if data exists as private variable resolve with it\n        return $q.when(flightDelayData)\n      } else {\n        return $localForage.getItem('flightData').then(function (data) {\n          if (!data) {  // if not found in local forage, reject with an error\n            return $q.reject(new Error('data not found'))\n          }\n          flightDelayData = data  // Set data in private variable and resolve with it\n          return $q.when(flightDelayData)\n        })\n      }\n    }\n\n        /**\n         * Called to get data from remote when data does not exists locally.\n         * @returns {Promise} = Promise will resolve with data or reject with error.\n         */\n    function getFlightDelayDataRemote () {\n      return $http.get(DATA_URL)\n                .then(getDataAsArray.bind(null, DATA_INFO.START_INDEX))\n                .then(convertDataToJson.bind(null, DATA_INFO.SEPERATOR))\n                .then(addAirPortData)\n                .then(cacheData)\n                .catch($q.reject)\n    }\n\n        /**\n         * Caches data locally in local database and in a private variable.\n         * @returns {Promise} = Promise will resolves with data, or rejects with error.\n         */\n    function cacheData (data) {\n      return $localForage.setItem('flightData', data)\n                .then(function (res) {\n                  flightDelayData = res // store in instance variable\n                  return flightDelayData\n                })\n    }\n\n        /**\n         * Queries for flight delays.\n         * @param {Object} query - Represents selected data points, day, origin and destination.\n         * @param {String} data - Flight delays data.\n         * @returns {Object} = Object representing delay  data, delay ratio data, average delay ratio, max delay ratio.\n         */\n    function queryFlightDelays (query, data) {\n      var delayTimeData = []\n      var delayRatioData = []\n      var totalDelayRatio = 0\n      var maxDelayRatio = 0\n      data.filter(function (item) { // if delayed and it matches query parameters\n        return item.delayed &&\n                    item.day === query.day.id &&\n                    item.destination === query.destination &&\n                    item.origin === query.origin\n      })\n                .forEach(function (item) {\n                  delayTimeData.push(item.departureTimeMin) // add time the flight departed to its list\n                  delayRatioData.push(item.delayRatio) // add delay ratio(precalculated) to its list\n                  totalDelayRatio += item.delayRatio   // add to total delay ratio used for calculating average delay ratio\n                  if (item.delayRatio > maxDelayRatio) { // keep track of the max delay ratio, used for ploting histogram\n                    maxDelayRatio = item.delayRatio\n                  }\n                })\n            // get average delay ratio\n      var averageDelayRatio = !delayRatioData.length ? 0 : Math.round((totalDelayRatio / delayRatioData.length) * 100) / 100\n      maxDelayRatio = Math.round(maxDelayRatio)\n      return { delayTimeData: delayTimeData, delayRatioData: delayRatioData, averageDelayRatio: averageDelayRatio, maxDelayRatio: maxDelayRatio }\n    }\n\n        /**\n         * Called to get data, check data locally first, if not found check remotely.\n         * @returns {Promise} = Promise resolves with data or reject.\n         */\n    function getFlightDelayData () {\n      return getFlightDelayDataLocal()\n                .catch(getFlightDelayDataRemote)\n    }\n\n        /**\n         * Queries for flight delays.\n         * @param {Object} query - Represents selected data points, day, origin.\n         * @param {String} data - Flight delays data.\n         * @returns {Object} = Object representing list of delays and corresponding list of distance.\n         */\n    function getDelaysByDistance (query, data) {\n      var delays = []\n      var distances = []\n      data.filter(function (item) {\n        return item.delayed && item.day === query.day.id && item.origin === query.origin\n      }).forEach(function (item) {\n        delays.push(item.arrivalDelay)\n        distances.push(item.distance)\n      })\n      return { delays: delays, distances: distances }\n    }\n\n    function validateQuery (query) {\n      return Object.keys(query).every(function (key) {\n        return query[key]\n      })\n    }\n\n    return {\n      getFlightDelayData: getFlightDelayData,\n      queryFlightDelays: queryFlightDelays,\n      getDelaysByDistance: getDelaysByDistance,\n      validateQuery: validateQuery\n    }\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .controller('FlightDelaysController', FlightDelaysController)\n\n  FlightDelaysController.$inject = ['$timeout', 'WEEK_DAYS', 'FlightDelayService', 'FlightDelayChartService', 'flightDelayData', 'cfpLoadingBar']\n\n  function FlightDelaysController ($timeout, WEEK_DAYS, FlightDelayService, FlightDelayChartService, flightDelayData, cfpLoadingBar) {\n    var vm = this\n    vm.flightDelayData = flightDelayData\n    vm.selected = { day: '', origin: '', destination: '' } // keep track of search parameters\n\n    vm.weekDays = WEEK_DAYS\n\n    var chartOptions = {\n      arrivalDelayTime: { // keep track of arrival delays chart options\n        bins: 24,\n        max: 0,\n        intervals: 60,\n        xAxis: 'Hour of the day (departure time)',\n        yAxis: 'Frequency of arrival delays'\n      },\n      arrivalDelayRatio: { // keep track of arrival delay ratio chart options.\n        xAxisFormat: null,\n        bins: 10,\n        max: 0,\n        intervals: 10,\n        xAxis: 'Delay ratio in %',\n        yAxis: 'Frequency of arrival delay  ratio',\n        drawLine: { value: 0, text: 'Average(%) is ', chartId: 'ratios' }\n      }\n    }\n\n    function preBind (interval) { // prebind interval to x axis chart tick\n      return function (d) {\n        return Math.round(d * interval)\n      }\n    }\n\n    vm.chartData = {} //\n    vm.histogramOptions = {}\n\n    vm.enableSearch = function () {\n      return FlightDelayService.validateQuery(vm.selected)\n    }\n\n    vm.search = function () {\n      cfpLoadingBar.start()\n\n      $timeout(function () {\n        cfpLoadingBar.complete()\n        // get data that matches the current selection\n        var delayData = FlightDelayService.queryFlightDelays(vm.selected, vm.flightDelayData.data)\n            // set delay chart properties\n        var arrivalData = getArrivalDelayHistogramData(delayData.delayTimeData, chartOptions.arrivalDelayTime)\n        vm.chartData.arrivalDelaytime = arrivalData.chartData\n        chartOptions.arrivalDelayTime.max = arrivalData.max // set chart max y axis option\n\n        vm.histogramOptions.arrivalDelayTime = FlightDelayChartService.getHistogramOptions(chartOptions.arrivalDelayTime)\n\n        var averageDelayRatio = delayData.averageDelayRatio\n        var maxDelayRatio = delayData.maxDelayRatio\n        chartOptions.arrivalDelayRatio.drawLine.value = averageDelayRatio // set the value of the average delay ratio\n            // set interval here based on maxDelayRatio\n            // maxDelayRatio/bins\n        var delayRatioChartInterval = maxDelayRatio ? maxDelayRatio / chartOptions.arrivalDelayRatio.bins : 10\n        chartOptions.arrivalDelayRatio.intervals = delayRatioChartInterval\n            // prebind intervals into xAxis formatter\n        chartOptions.arrivalDelayRatio.xAxisFormat = preBind(chartOptions.arrivalDelayRatio.intervals)\n\n            // set delay ratio chart properties\n        var delayRatioData = getArrivalDelayHistogramData(delayData.delayRatioData, chartOptions.arrivalDelayRatio)\n        vm.chartData.arrivalDelayRatio = delayRatioData.chartData\n        chartOptions.arrivalDelayRatio.max = delayRatioData.max\n        vm.histogramOptions.arrivalDelayRatio = FlightDelayChartService.getHistogramOptions(chartOptions.arrivalDelayRatio)\n      }, 2000)\n    }\n\n        /**\n         * Get the required histogram data. called by both histogram charts\n         * @param {Object} data- Chart data.\n         * @param {Object}  options-  options.\n         * @returns {Object} = Object with  Chart Data and max y axis value.\n         */\n    function getArrivalDelayHistogramData (data, options) {\n      var range = [0, options.bins * options.intervals] // range on the xaxis\n      var binData = d3.layout.histogram().bins(options.bins).range(range)(data)\n      var chartData = { bar: true, values: [] }\n      var localMaxY = 0\n      binData.forEach(function (item) {\n        if (localMaxY < item.y) {\n          localMaxY = item.y\n        }\n        chartData.values.push([item.x, item.y])\n      })\n      return { chartData: [chartData], max: localMaxY }\n    }\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .factory('FlightDelayChartService', FlightDelayChartService)\n\n  FlightDelayChartService.$inject = []\n\n  function FlightDelayChartService () {\n        /**\n         * Get the options required for a histogram.\n         * @param {Object} options- option.\n         * @returns {Object} = Chart option.\n         */\n    function getHistogramOptions (options) {\n      function getYDomain () {\n        return options.max ? [0, options.max] : [0]\n      }\n\n      var yDomain = getYDomain()\n      var histogramOptions = {\n        chart: {\n          type: 'historicalBarChart',\n          margin: {\n            top: 20,\n            right: 20,\n            bottom: 65,\n            left: 50\n          },\n          useInteractiveGuideline: false,\n          callback: function (chart) {\n            if (options.drawLine && options.drawLine.value) {\n              var xScale = chart.xAxis.scale()\n              var margin = chart.margin()\n              var svg = d3.select('#' + options.drawLine.chartId + ' svg')\n              var height = chart.height()\n              var onXAxis = xScale(options.drawLine.value) / options.intervals\n              svg.append('line')\n                                .style('stroke', '#FF7F0E')\n                                .style('stroke-width', '2.5px')\n                                .attr('x1', onXAxis + margin.left)\n                                .attr('y1', margin.top)\n                                .attr('x2', onXAxis + margin.left)\n                                .attr('y2', height - margin.bottom)\n              svg.append('text')\n                                .attr('x', onXAxis + margin.left)\n                                .attr('y', margin.top)\n                                .text(options.drawLine.text + '' + options.drawLine.value)\n            }\n          },\n          height: 300,\n          x: function (d, i) {\n            return i\n          },\n          y: function (d) {\n            return d[1]\n          },\n          showValues: true,\n          valueFormat: function (d) {\n            return d3.format(',.1f')(d)\n          },\n          duration: 100,\n          xAxis: {\n            axisLabel: options.xAxis,\n            tickFormat: function (d) {\n              var format = options.xAxisFormat\n              return format && angular.isFunction(format) ? format(d) : d\n            },\n            ticks: options.bins\n\n          },\n          yAxis: {\n            axisLabel: options.yAxis,\n            axisLabelDistance: -10,\n            tickFormat: function (d) {\n              return d3.format(',.1f')(d)\n            }\n          },\n          yDomain: yDomain\n        }\n      }\n      return histogramOptions\n    }\n\n    function getScatterChartOptions (options) {\n      var scatterChartOptions = {\n        chart: {\n          type: 'scatterChart',\n          height: 400,\n\n          showDistX: true,\n          showDistY: true,\n          tooltipContent: function (key) {\n            return '<h3>' + key + '</h3>'\n          },\n          duration: 100,\n          useInteractiveGuideline: true,\n          xAxis: {\n            axisLabel: options.xAxis\n          },\n          yAxis: {\n            axisLabel: options.yAxis,\n            tickFormat: function (d) {\n              return d3.format('.02f')(d)\n            },\n            axisLabelDistance: -5\n          }\n        }\n      }\n      return scatterChartOptions\n    }\n    return {\n      getHistogramOptions: getHistogramOptions,\n      getScatterChartOptions: getScatterChartOptions\n    }\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n    .module('App')\n    .controller('FlightDelaysAnalysisController', FlightDelaysAnalysisController)\n\n  FlightDelaysAnalysisController.$inject = ['$timeout', 'WEEK_DAYS', 'FlightDelayService', 'FlightDelayChartService', 'flightDelayData', 'cfpLoadingBar']\n\n  function FlightDelaysAnalysisController ($timeout, WEEK_DAYS, FlightDelayService, FlightDelayChartService, flightDelayData, cfpLoadingBar) {\n    var vm = this\n    vm.chartOptions = { xAxis: 'Distance in miles', yAxis: 'Arrival delay in minutes' }\n    vm.analysis = {}\n    vm.weekDays = WEEK_DAYS\n    vm.flightDelayData = flightDelayData\n\n    vm.selected = { day: '', origin: '' }\n\n    vm.enableSearch = function () {\n      return FlightDelayService.validateQuery(vm.selected)\n    }\n\n    vm.search = function () {\n      cfpLoadingBar.start()\n      $timeout(function () {\n        cfpLoadingBar.complete()\n        // get delays and corresponding distances for selected params\n        var data = FlightDelayService.getDelaysByDistance(vm.selected, vm.flightDelayData.data)\n        var chartData = getAnalysisData(data) // format as chart data\n        vm.analysis.data = chartData\n        vm.analysis.options = FlightDelayChartService.getScatterChartOptions(vm.chartOptions) // get chart params\n      }, 1000)\n    }\n       /**\n         * Get the required histogram data. called by both histogram charts\n         * @param {Object} data- Object representing delays and distances.\n         * @param {Object}  options-  options.\n         * @returns {Object} = Object with  Chart Data.\n         */\n    function getAnalysisData (data) {\n      var distances = data.distances\n      var delays = data.delays\n      var values = distances.map(function (distance, index) {\n        return { x: distance, y: delays[index] }\n      })\n\n      return [{\n        values: values,\n        key: 'Arrival delay against distance',\n        strokeWidth: 2,\n        classed: 'dashed'\n      }]\n    }\n  }\n})()\n;\n(function () {\n  'use strict'\n\n  angular\n        .module('App')\n        .config(stateConfig)\n\n  stateConfig.$inject = ['$stateProvider']\n\n  function stateConfig ($stateProvider) {\n    $stateProvider.state('app', {\n      abstract: true,\n      views: {\n        'navbar@': {\n          templateUrl: 'app/layouts/navbar/navbar.html',\n          controller: 'NavbarController',\n          controllerAs: 'vm'\n        }\n      },\n      resolve: {\n        flightDelayData: ['FlightDelayService',\n          function (FlightDelayService) {\n            return FlightDelayService.getFlightDelayData()\n          }\n        ]\n      }\n    })\n  }\n})()\n;\n(function () {\n  'use strict'\n    // DO NOT EDIT THIS FILE, EDIT THE GULP TASK NGCONSTANT SETTINGS INSTEAD WHICH GENERATES THIS FILE\n    angular\n        .module('App')\n        .constant('DEBUG_INFO_ENABLED', false)\n        .constant('DATA_URL', \"/RIATest/content/data.csv\")\n        .constant('DATA_INFO', {\n\t\"START_INDEX\": 1,\n\t\"SEPERATOR\": \",\",\n\t\"FLIGHT_DATE_COL\": 0,\n\t\"ORIGIN_COL\": 1,\n\t\"DEST_COL\": 2,\n\t\"DEP_TIME_COL\": 3,\n\t\"ARR_TIME_COL\": 4,\n\t\"ARR_DELAY_COL\": 5,\n\t\"ELAPSED_TIME_COL\": 6,\n\t\"DISTANCE_COL\": 7\n})\n;\n})();\n;(function(){angular.module(\"App\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/flight-delays/flight-delays.html\",\"<div><div class=\\\"row search-box\\\"><div class=\\\"col-md-3\\\"><ui-select ng-model=\\\"vm.selected.day\\\" title=\\\"Week day\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Choose a week day\\\"><span ng-bind=\\\"vm.selected.day.name\\\"></span></ui-select-match><ui-select-choices repeat=\\\"day in (vm.weekDays | filter: $select.search) track by day.id\\\" position=\\\"down\\\"><span ng-bind=\\\"day.name\\\"></span></ui-select-choices></ui-select></div><div class=\\\"col-md-3\\\"><ui-select ng-model=\\\"vm.selected.origin\\\" title=\\\"Origin airport\\\"><ui-select-match placeholder=\\\"Choose origin airport\\\"><span ng-bind=\\\"vm.selected.origin\\\"></span></ui-select-match><ui-select-choices repeat=\\\"airport in (vm.flightDelayData.airports | filter: $select.search) track by airport\\\" position=\\\"down\\\"><span ng-bind=\\\"airport\\\"></span></ui-select-choices></ui-select></div><div class=\\\"col-md-3\\\"><ui-select ng-model=\\\"vm.selected.destination\\\" title=\\\"Destination airport\\\"><ui-select-match placeholder=\\\"Choose destination airport\\\"><span ng-bind=\\\"vm.selected.destination\\\"></span></ui-select-match><ui-select-choices repeat=\\\"airport in (vm.flightDelayData.airports | filter: $select.search) track by airport\\\" position=\\\"down\\\"><span ng-bind=\\\"airport\\\"></span></ui-select-choices></ui-select></div><div class=\\\"col-md-3\\\"><button class=\\\"btn btn-primary\\\" ng-click=\\\"vm.search()\\\" ng-disabled=\\\"!vm.enableSearch()\\\"><span class=\\\"glyphicon glyphicon-search\\\"></span> <span>Search</span></button></div></div><div class=\\\"vertical-offset-50\\\"></div><div class=\\\"row\\\"><div class=\\\"col-md-6 col-xm-12\\\" ng-if=\\\"vm.histogramOptions.arrivalDelayTime\\\"><div class=\\\"chart-box radius-primary\\\"><div class=\\\"padded-title\\\"><h4>Arrival delays</h4></div><nvd3 options=\\\"vm.histogramOptions.arrivalDelayTime\\\" data=\\\"vm.chartData.arrivalDelaytime\\\"></nvd3></div></div><div class=\\\"col-md-6 col-xm-12\\\" ng-if=\\\"vm.histogramOptions.arrivalDelayRatio\\\"><div class=\\\"chart-box radius-primary\\\"><div class=\\\"padded-title\\\"><h4>Arrival delay ratio</h4></div><nvd3 id=\\\"ratios\\\" options=\\\"vm.histogramOptions.arrivalDelayRatio\\\" data=\\\"vm.chartData.arrivalDelayRatio\\\"></nvd3></div></div></div></div>\");\n$templateCache.put(\"app/flight-delays/analysis/analysis.html\",\"<div><div class=\\\"row search-box\\\"><div class=\\\"col-md-5\\\"><ui-select ng-model=\\\"vm.selected.day\\\" title=\\\"Week day\\\" theme=\\\"bootstrap\\\"><ui-select-match placeholder=\\\"Choose a week day\\\"><span ng-bind=\\\"vm.selected.day.name\\\"></span></ui-select-match><ui-select-choices repeat=\\\"day in (vm.weekDays | filter: $select.search) track by day.id\\\" position=\\\"down\\\"><span ng-bind=\\\"day.name\\\"></span></ui-select-choices></ui-select></div><div class=\\\"col-md-5\\\"><ui-select ng-model=\\\"vm.selected.origin\\\" title=\\\"Origin airport\\\"><ui-select-match placeholder=\\\"Choose origin airport\\\"><span ng-bind=\\\"vm.selected.origin\\\"></span></ui-select-match><ui-select-choices repeat=\\\"airport in (vm.flightDelayData.airports | filter: $select.search) track by airport\\\" position=\\\"down\\\"><span ng-bind=\\\"airport\\\"></span></ui-select-choices></ui-select></div><div class=\\\"col-md-2\\\"><button class=\\\"btn btn-primary\\\" ng-click=\\\"vm.search()\\\" ng-disabled=\\\"!vm.enableSearch()\\\"><span class=\\\"glyphicon glyphicon-search\\\"></span> <span>Search</span></button></div></div><div class=\\\"vertical-offset-50\\\"></div><div class=\\\"row\\\"><div class=\\\"col-md-12 col-xm-12\\\" ng-if=\\\"vm.analysis.data\\\"><div class=\\\"chart-box radius-primary\\\"><div class=\\\"padded-title\\\"><h4>Delay distance scatter chart analysis</h4></div><nvd3 options=\\\"vm.analysis.options\\\" data=\\\"vm.analysis.data\\\"></nvd3></div></div></div></div>\");\n$templateCache.put(\"app/layouts/navbar/navbar.html\",\"<nav class=\\\"navbar navbar-default\\\" role=\\\"navigation\\\"><div class=\\\"container\\\"><div class=\\\"navbar-header\\\"><button type=\\\"button\\\" class=\\\"navbar-toggle\\\" ng-click=\\\"vm.toggleNavbar()\\\"><span class=\\\"sr-only\\\">Toggle navigation</span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span></button> <a class=\\\"navbar-brand logo\\\" href=\\\"#/\\\" ng-click=\\\"vm.collapseNavbar()\\\"><img class=\\\"logo-img\\\" src=\\\"content/images/logo.png\\\"> <span>Flight Delay</span></a></div><div class=\\\"navbar-collapse\\\" uib-collapse=\\\"vm.isNavbarCollapsed\\\"><ul class=\\\"nav navbar-nav navbar-left\\\"><li ui-sref-active=\\\"active\\\"><a ui-sref=\\\"flight-delays\\\" ng-click=\\\"vm.collapseNavbar()\\\"><span class=\\\"glyphicon glyphicon-time\\\"></span> <span class=\\\"hidden-sm\\\">Arrival delay histograms</span></a></li><li ui-sref-active=\\\"active\\\"><a ui-sref=\\\"analysis\\\" ng-click=\\\"vm.collapseNavbar()\\\"><span class=\\\"glyphicon glyphicon-stats\\\"></span> <span class=\\\"hidden-sm\\\">Distance delay correlations</span></a></li></ul></div></div></nav>\");}]);})();"],"sourceRoot":"/source/"}
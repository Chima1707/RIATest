!function(){"use strict";function a(a){a.otherwise("/flight-delays")}angular.module("App",["ui.bootstrap","ui.router","LocalForageModule","ui.select","ngSanitize","nvd3"]).config(a),a.$inject=["$urlRouterProvider"]}(),function(){"use strict";function a(){function a(){e.isNavbarCollapsed=!e.isNavbarCollapsed}function t(){e.isNavbarCollapsed=!0}var e=this;e.isNavbarCollapsed=!0,e.toggleNavbar=a,e.collapseNavbar=t}angular.module("App").controller("NavbarController",a),a.$inject=[]}(),function(){"use strict";function a(a){a.state("flight-delays",{parent:"app",url:"/flight-delays",views:{"content@":{templateUrl:"app/flight-delays/flight-delays.html",controller:"FlightDelaysController",controllerAs:"vm"}}})}angular.module("App").config(a),a.$inject=["$stateProvider"]}(),function(){"use strict";function a(a,t,e,i,r){function n(a,t){var e=t.data;return e.split("\n").slice(a).filter(function(a){return a})}function l(a,t){function i(a){var t=a.match(/.{1,2}/g).map(Number),e=t[0],i=t[1];return e?60*e+i:i}function r(a){return a.replace(/"/g,"")}function n(a,t){return a/t*100}return a=a||",",t.map(function(t){var l=t.split(a),s=new Date(l[e.FLIGHT_DATE_COL]),o=s.getDay(),c=Number(l[e.DISTANCE_COL]),d=l[e.DEP_TIME_COL];d=r(d);var u=i(d),v=l[e.ARR_TIME_COL];v=r(v);var p=i(v),h=Number(l[e.ELAPSED_TIME_COL]),y=Number(l[e.ARR_DELAY_COL]),m=y>0,g=m?n(y,h):0,f=String(l[e.ORIGIN_COL]);f=r(f);var D=String(l[e.DEST_COL]);return D=r(D),{flightDate:s,day:o,origin:f,destination:D,departureTime:d,departureTimeMin:u,arrivalTime:v,arrivalTimeMin:p,arrivalDelay:y,elapsedTime:h,distance:c,delayed:m,delayRatio:g}})}function s(a){var t={};a.forEach(function(a){t[a.origin]||(t[a.origin]=!0),t[a.destination]||(t[a.destination]=!0)});var e=Object.keys(t);return{data:a,airports:e}}function o(){return p?i.when(p):r.getItem("flightData").then(function(a){return a?(p=a,i.when(p)):i.reject(new Error("data not found"))})}function c(){return a.get(t).then(n.bind(null,e.START_INDEX)).then(l.bind(null,e.SEPERATOR)).then(s).then(d)["catch"](i.reject)}function d(a){return r.setItem("flightData",a).then(function(a){return p=a})}function u(a,t){var e=[],i=[],r=0,n=0;t.filter(function(t){return t.delayed&&t.day===a.day.id&&t.destination===a.destination&&t.origin===a.origin}).forEach(function(a){e.push(a.departureTimeMin),i.push(a.delayRatio),r+=a.delayRatio,a.delayRatio>n&&(n=a.delayRatio)});var l=i.length?Math.round(r/i.length*100)/100:0;return n=Math.round(n),{delayTimeData:e,delayRatioData:i,averageDelayRatio:l,maxDelayRatio:n}}function v(){return o()["catch"](c)}var p;return{getFlightDelayData:v,queryFlightDelays:u}}angular.module("App").factory("FlightDelayService",a),a.$inject=["$http","DATA_URL","DATA_INFO","$q","$localForage"]}(),function(){"use strict";function a(a,t,e){function i(a){return function(t){return Math.round(t*a)}}function r(a,t){var e=[0,t.bins*t.intervals],i=d3.layout.histogram().bins(t.bins).range(e)(a),r={bar:!0,values:[]},n=0;return i.forEach(function(a){n<a.y&&(n=a.y),r.values.push([a.x,a.y])}),t.max=n,[r]}var n=this;n.flightDelayData=e,n.selected={day:"",origin:"",destination:""},n.weekDays=[{id:0,name:"Sunday"},{id:1,name:"Monday"},{id:2,name:"Tuesday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"}];var l={arrivalDelayTime:{bins:24,max:0,intervals:60,xAxis:"Hour of the day (departure time)",yAxis:"Frequency of arrival delays"},arrivalDelayRatio:{xAxisFormat:null,bins:10,max:0,intervals:10,xAxis:"Delay ratio in %",yAxis:"Frequency of arrival delays",drawLine:{value:0,text:"Average(%) is ",chartId:"ratios"}}};n.chartData={},n.histogramOptions={},n.enableSearch=function(){return Object.keys(n.selected).every(function(a){return n.selected[a]})},n.search=function(){var e=a.queryFlightDelays(n.selected,n.flightDelayData.data);n.chartData.arrivalDelaytime=r(e.delayTimeData,l.arrivalDelayTime),n.histogramOptions.arrivalDelayTime=t.getHistogramOptions(l.arrivalDelayTime);var s=e.averageDelayRatio,o=e.maxDelayRatio;l.arrivalDelayRatio.drawLine.value=s;var c=o?o/l.arrivalDelayRatio.bins:10;l.arrivalDelayRatio.intervals=c,l.arrivalDelayRatio.xAxisFormat=i(l.arrivalDelayRatio.intervals),n.chartData.arrivalDelayRatio=r(e.delayRatioData,l.arrivalDelayRatio),n.histogramOptions.arrivalDelayRatio=t.getHistogramOptions(l.arrivalDelayRatio)}}angular.module("App").controller("FlightDelaysController",a),a.$inject=["FlightDelayService","FlightDelayChartService","flightDelayData"]}(),function(){"use strict";function a(){function a(a){function t(){return a.max?[0,a.max]:[0]}var e=t(),i={chart:{type:"historicalBarChart",margin:{top:20,right:20,bottom:65,left:50},callback:function(t){if(a.drawLine&&a.drawLine.value){var e=t.xAxis.scale(),i=t.margin(),r=d3.select("#"+a.drawLine.chartId+" svg"),n=t.height(),l=e(a.drawLine.value)/a.intervals;r.append("line").style("stroke","#FF7F0E").style("stroke-width","2.5px").attr("x1",l+i.left).attr("y1",i.top).attr("x2",l+i.left).attr("y2",n-i.bottom),r.append("text").attr("x",l+i.left).attr("y",i.top).text(a.drawLine.text+""+a.drawLine.value)}},height:300,x:function(a,t){return t},y:function(a){return a[1]},showValues:!0,valueFormat:function(a){return d3.format(",.1f")(a)},duration:100,xAxis:{axisLabel:a.xAxis,tickFormat:function(t){var e=a.xAxisFormat;return e&&angular.isFunction(e)?e(t):t},ticks:a.bins},yAxis:{axisLabel:a.yAxis,axisLabelDistance:-10,tickFormat:function(a){return d3.format(",.1f")(a)}},yDomain:e}};return i}return{getHistogramOptions:a}}angular.module("App").factory("FlightDelayChartService",a),a.$inject=[]}(),function(){"use strict";function a(a){a.state("app",{"abstract":!0,views:{"navbar@":{templateUrl:"app/layouts/navbar/navbar.html",controller:"NavbarController",controllerAs:"vm"}},resolve:{flightDelayData:["FlightDelayService",function(a){return a.getFlightDelayData()}]}})}angular.module("App").config(a),a.$inject=["$stateProvider"]}(),function(){"use strict";angular.module("App").constant("DEBUG_INFO_ENABLED",!1).constant("DATA_URL","/RIATest/content/data.csv").constant("DATA_INFO",{START_INDEX:1,SEPERATOR:",",FLIGHT_DATE_COL:0,ORIGIN_COL:1,DEST_COL:2,DEP_TIME_COL:3,ARR_TIME_COL:4,ARR_DELAY_COL:5,ELAPSED_TIME_COL:6,DISTANCE_COL:7})}(),function(){angular.module("App").run(["$templateCache",function(a){a.put("app/flight-delays/flight-delays.html",'<div><div class="row search-box"><div class="col-md-3"><ui-select ng-model="vm.selected.day" title="Week day" theme="bootstrap"><ui-select-match placeholder="Choose a week day"><span ng-bind="vm.selected.day.name"></span></ui-select-match><ui-select-choices repeat="day in (vm.weekDays | filter: $select.search) track by day.id" position="down"><span ng-bind="day.name"></span></ui-select-choices></ui-select></div><div class="col-md-3"><ui-select ng-model="vm.selected.origin" title="Origin airport"><ui-select-match placeholder="Choose origin airport"><span ng-bind="vm.selected.origin"></span></ui-select-match><ui-select-choices repeat="airport in (vm.flightDelayData.airports | filter: $select.search) track by airport" position="down"><span ng-bind="airport"></span></ui-select-choices></ui-select></div><div class="col-md-3"><ui-select ng-model="vm.selected.destination" title="Destination airport"><ui-select-match placeholder="Choose destination airport"><span ng-bind="vm.selected.destination"></span></ui-select-match><ui-select-choices repeat="airport in (vm.flightDelayData.airports | filter: $select.search) track by airport" position="down"><span ng-bind="airport"></span></ui-select-choices></ui-select></div><div class="col-md-3"><button class="btn btn-primary" ng-click="vm.search()" ng-disabled="!vm.enableSearch()"><span class="glyphicon glyphicon-search"></span> <span>Search</span></button></div></div><div class="vertical-offset-50"></div><div class="row"><div class="col-md-6 col-xm-12"><div class="chart-box radius-primary"><div class="padded-title"><h4>Arrival delays</h4></div><nvd3 options="vm.histogramOptions.arrivalDelayTime" data="vm.chartData.arrivalDelaytime"></nvd3></div></div><div class="col-md-6 col-xm-12"><div class="chart-box radius-primary"><div class="padded-title"><h4>Arrival delay ratio</h4></div><nvd3 id="ratios" options="vm.histogramOptions.arrivalDelayRatio" data="vm.chartData.arrivalDelayRatio"></nvd3></div></div></div></div>'),a.put("app/layouts/navbar/navbar.html",'<nav class="navbar navbar-default" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle" ng-click="vm.toggleNavbar()"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand logo" href="#/" ng-click="vm.collapseNavbar()"><img class="logo-img" src="content/images/logo-jhipster-a30deb26b4.png"> <span>Flight Delay</span></a></div><div class="navbar-collapse" uib-collapse="vm.isNavbarCollapsed"><ul class="nav navbar-nav navbar-left"><li ui-sref-active="active"><a ui-sref="flight-delays" ng-click="vm.collapseNavbar()"><span class="hidden-sm">Arrival delays</span></a></li></ul></div></div></nav>')}])}();
//# sourceMappingURL=app-ddf6c1ae9d.js.map
